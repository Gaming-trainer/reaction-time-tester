<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dual Mode Challenge</title>
    <style>
        :root {
            --primary: #4CAF50;
            --secondary: #2196F3;
            --dark: #121212;
            --light: #f5f5f5;
            --gray: #1e1e1e;
            --red: #f44336;
        }
        body {
            font-family: Arial, sans-serif;
            background: var(--dark);
            color: var(--light);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        #leaderboard {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(30, 30, 30, 0.9);
            padding: 15px;
            border-radius: 10px;
            width: 200px;
        }
        #game-container {
            margin-top: 60px;
            width: 90%;
            max-width: 600px;
        }
        #game-screen {
            width: 100%;
            height: 400px;
            background: var(--gray);
            border-radius: 10px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }
        .dot {
            width: 100px;
            height: 100px;
            background: var(--primary);
            border-radius: 50%;
            position: absolute;
            box-shadow: 0 0 20px var(--primary);
            transform: translate(-50%, -50%);
            transition: transform 0.1s;
        }
        button {
            padding: 12px 30px;
            font-size: 18px;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            margin: 5px;
        }
        #start-btn { background: var(--primary); }
        #back-btn { background: var(--gray); }
        #result {
            font-size: 24px;
            margin: 20px 0;
            min-height: 36px;
        }
        .timer {
            font-size: 20px;
            margin-bottom: 10px;
            color: var(--secondary);
        }
        #mode-selection {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        .mode-btn {
            padding: 20px 40px;
            margin: 15px;
            font-size: 24px;
            border-radius: 10px;
            cursor: pointer;
            border: none;
            color: white;
            transition: transform 0.2s;
            width: 300px;
        }
        #reflex-btn { background: var(--primary); }
        #speed-btn { background: var(--secondary); }
    </style>
</head>
<body>
    <!-- Mode Selection -->
    <div id="mode-selection">
        <h1>Choose Your Challenge</h1>
        <button id="reflex-btn" class="mode-btn">
            ‚ö° Reflex Tester<br>
            <small>Measure reaction time</small>
        </button>
        <button id="speed-btn" class="mode-btn">
            üéØ Speed Clicker<br>
            <small>Test clicks in 30 seconds</small>
        </button>
    </div>

    <!-- Leaderboard -->
    <div id="leaderboard">
        <h3>üèÜ Best Scores</h3>
        <div id="mode-display">Mode: <span id="current-mode">-</span></div>
        <div id="reflex-scores">
            <h4>‚ö° Reflex</h4>
            <ol id="reflex-scores-list"></ol>
        </div>
        <div id="speed-scores">
            <h4>üéØ Speed</h4>
            <ol id="speed-scores-list"></ol>
        </div>
    </div>

    <!-- Game UI -->
    <div id="game-container">
        <h1 id="game-title">‚ö° Reflex Tester</h1>
        <div id="result">Select a mode to begin</div>
        <div class="timer" id="timer"></div>
        <div id="game-screen"></div>
        <div>
            <button id="start-btn">START</button>
            <button id="back-btn">BACK TO MENU</button>
        </div>
    </div>

    <script>
        // Game elements
        const gameScreen = document.getElementById("game-screen");
        const startBtn = document.getElementById("start-btn");
        const resultDisplay = document.getElementById("result");
        const timerDisplay = document.getElementById("timer");
        const gameTitle = document.getElementById("game-title");
        const currentModeDisplay = document.getElementById("current-mode");
        const reflexScoresList = document.getElementById("reflex-scores-list");
        const speedScoresList = document.getElementById("speed-scores-list");
        const modeSelection = document.getElementById("mode-selection");
        const reflexBtn = document.getElementById("reflex-btn");
        const speedBtn = document.getElementById("speed-btn");
        const backBtn = document.getElementById("back-btn");

        // Game state
        let startTime;
        let timeoutId;
        let gameActive = false;
        let currentMode = "";
        let dotCount = 0;
        let gameTimer;
        let lastClickTime = 0;
        const SPEED_MODE_DURATION = 30;
        let bestScores = { reflex: [], speed: [] };

        // Initialize
        loadScores();
        updateLeaderboards();

        /* ===== CORE FUNCTIONS ===== */
        function loadScores() {
            try {
                const saved = JSON.parse(localStorage.getItem("bestScores")) || {};
                bestScores.reflex = saved.reflex || [];
                bestScores.speed = saved.speed || [];
            } catch (e) {
                console.warn("Failed to load scores:", e);
            }
        }

        function saveScores() {
            try {
                localStorage.setItem("bestScores", JSON.stringify(bestScores));
            } catch (e) {
                console.warn("Failed to save scores:", e);
            }
        }

        function updateLeaderboards() {
            updateLeaderboard("reflex");
            updateLeaderboard("speed");
        }

        function updateLeaderboard(mode) {
            const list = mode === "reflex" ? reflexScoresList : speedScoresList;
            list.innerHTML = "";
            
            bestScores[mode]
                .sort((a, b) => mode === "reflex" ? a.time - b.time : b.score - a.score)
                .slice(0, 5)
                .forEach(score => {
                    const li = document.createElement("li");
                    li.textContent = mode === "reflex" 
                        ? `${score.time.toFixed(3)}s`
                        : `${score.score} clicks`;
                    list.appendChild(li);
                });
        }

        function resetGame() {
            clearTimeout(timeoutId);
            clearInterval(gameTimer);
            gameScreen.innerHTML = "";
            gameActive = false;
            startBtn.style.display = "block";
            timerDisplay.textContent = "";
            dotCount = 0;
            
            if (currentMode === "reflex") {
                resultDisplay.textContent = "Press START to begin";
            } else {
                resultDisplay.textContent = "Click as many dots as possible!";
            }
        }

        function startGame() {
            resetGame();
            gameActive = true;
            startBtn.style.display = "none";
            dotCount = 0;
            
            if (currentMode === "reflex") {
                resultDisplay.textContent = "Wait for the green dot...";
                const delay = 1000 + Math.random() * 4000;
                
                timeoutId = setTimeout(() => {
                    createDot(true);
                    startTime = Date.now();
                }, delay);
            } else {
                resultDisplay.textContent = "Click as many dots as possible!";
                startTime = Date.now();
                createDot(false);
                
                let timeLeft = SPEED_MODE_DURATION;
                timerDisplay.textContent = `Time: ${timeLeft}s`;
                
                gameTimer = setInterval(() => {
                    timeLeft--;
                    timerDisplay.textContent = `Time: ${timeLeft}s`;
                    
                    if (timeLeft <= 0) {
                        clearInterval(gameTimer);
                        endSpeedMode();
                    }
                }, 1000);
            }
        }

        function createDot(center) {
            gameScreen.innerHTML = "";
            const dot = document.createElement("div");
            dot.className = "dot";
            
            if (center) {
                dot.style.left = "50%";
                dot.style.top = "50%";
            } else {
                dot.style.left = (20 + Math.random() * 60) + "%";
                dot.style.top = (20 + Math.random() * 60) + "%";
            }
            
            gameScreen.appendChild(dot);
        }

        function endSpeedMode() {
            gameActive = false;
            gameScreen.innerHTML = "";
            resultDisplay.textContent = `Final score: ${dotCount} clicks`;
            
            bestScores.speed.push({
                score: dotCount,
                date: new Date().toISOString()
            });
            saveScores();
            updateLeaderboard("speed");
            
            startBtn.style.display = "block";
        }

        /* ===== EVENT HANDLERS ===== */
        gameScreen.addEventListener("click", (e) => {
            if (!gameActive) return;
            
            const now = Date.now();
            if (currentMode === "speed" && now - lastClickTime < 100) return;
            lastClickTime = now;
            
            if (e.target.classList.contains("dot")) {
                if (currentMode === "reflex") {
                    const reactionTime = (Date.now() - startTime) / 1000;
                    resultDisplay.textContent = `Your time: ${reactionTime.toFixed(3)}s`;
                    
                    bestScores.reflex.push({
                        time: reactionTime,
                        date: new Date().toISOString()
                    });
                    saveScores();
                    updateLeaderboard("reflex");
                    
                    gameActive = false;
                    startBtn.style.display = "block";
                } else {
                    dotCount++;
                    resultDisplay.textContent = `Clicks: ${dotCount}`;
                    createDot(false);
                }
            } else if (currentMode === "reflex") {
                clearTimeout(timeoutId);
                resultDisplay.textContent = "TOO SOON! Wait for the dot";
                setTimeout(() => {
                    resultDisplay.textContent = "Press START to try again";
                }, 1000);
                gameActive = false;
                startBtn.style.display = "block";
            }
        });

        reflexBtn.addEventListener("click", () => {
            currentMode = "reflex";
            currentModeDisplay.textContent = "Reflex";
            gameTitle.textContent = "‚ö° Reflex Tester";
            startGameMode();
        });

        speedBtn.addEventListener("click", () => {
            currentMode = "speed";
            currentModeDisplay.textContent = "Speed";
            gameTitle.textContent = "üéØ Speed Clicker";
            startGameMode();
        });

        backBtn.addEventListener("click", () => {
            modeSelection.style.display = "flex";
            gameContainer.style.display = "none";
            resetGame();
        });

        startBtn.addEventListener("click", startGame);

        function startGameMode() {
            modeSelection.style.display = "none";
            gameContainer.style.display = "block";
            resetGame();
        }
    </script>
</body>
</html>
